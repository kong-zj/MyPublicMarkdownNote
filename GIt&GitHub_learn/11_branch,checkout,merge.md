# 分支（用底层原理解释）

分支就是活动的指针，指向最新提交的commit对象

## ```.git```隐藏文件夹

![](resources/2022-11-28-23-25-41.png)

### ```git branch```

![](resources/2022-12-03-18-24-58.png)

HEAD文件：
HEAD中默认保存的是```master```分支
![](resources/2022-12-03-17-36-11.png)



refs文件夹：
![](resources/2022-12-03-17-37-45.png)

下面的heads文件夹中有内容：
![](resources/2022-12-03-17-42-25.png)

保存的内容是最后一次提交生成的commit对象的Hash值：
![](resources/2022-12-03-17-43-25.png)

### ```git checkout```

#### 分支名其实就是commit对象的Hash值

![](resources/2022-12-03-18-42-55.png)

![](resources/2022-12-03-19-09-50.png)

![](resources/2022-12-04-19-23-16.png)

![](resources/2022-12-04-19-24-03.png)

![](resources/2022-12-04-16-24-25.png)

创建新的分支，这时还没有切换分支
![](resources/2022-12-03-18-29-19.png)

切换分支
![](resources/2022-12-03-18-31-52.png)

切换分支就是让HEAD指向不同的分支
此时，HEAD中保存的是```damu```分支
![](resources/2022-12-03-18-38-58.png)

这时有新的提交，HEAD指针带着```damu```分支向前走，```master```分支还在原地
![](resources/2022-12-03-18-35-55.png)

#### 切换分支会动三个地方
1. HEAD
见上

2. 暂存区
![](resources/2022-12-04-19-43-30.png)
![](resources/2022-12-04-19-43-52.png)

3. 工作区
![](resources/2022-12-04-19-47-43.png)

#### 切换分支时的不同情况
![](resources/2022-12-04-19-28-44.png)

情况1：
![](resources/2022-12-04-19-49-20.png)
文件```c.txt```在```master```分支上没有接收管理，如果这时切换到```test```分支，文件```c.txt```在工作区不会被删除，防止弄丢，但是暂存区里没有这个文件

情况2： 
![](resources/2022-12-04-19-56-13.png)
文件```c.txt```在```master```分支上已暂存未提交，如果这时切换到```test```分支，文件```c.txt```也会暂存

以上两种情况不要做，会导致分支污染，因为Git不能明确地把操作分给某个分支，所以切换分支前，用```git status```来确保没有已修改未暂存、已暂存未提交的信息

#### 分支原理

![](resources/2022-12-04-20-58-10.png)

![](resources/2022-12-04-21-02-19.png)

![](resources/2022-12-04-21-03-06.png)

#### 实际案例
![](resources/2022-12-03-18-44-42.png)

![](resources/2022-12-04-20-21-41.png)

![](resources/2022-12-04-20-22-00.png)

![](resources/2022-12-04-20-29-56.png)

注意这里的```git lol```是```git log --oneline --decorate --graph --all```的自己设置的缩写

![](resources/2022-12-04-20-23-29.png)

配别名的方法
![](resources/2022-12-04-20-53-57.png)

如果原命令比较复杂，中间有空格，别忘了用双引号
![](resources/2022-12-04-20-55-37.png)

![](resources/2022-12-04-20-32-06.png)

下面用```git merge```来合并分支

##### 快进合并不会产生冲突

![](resources/2022-12-04-20-32-42.png)

![](resources/2022-12-04-20-34-04.png)

![](resources/2022-12-04-20-34-52.png)

回到```iss53```分支继续工作，直到完成
![](resources/2022-12-04-20-36-42.png)

![](resources/2022-12-04-20-37-25.png)

![](resources/2022-12-04-20-47-14.png)

![](resources/2022-12-04-20-48-15.png)

##### 典型合并可能会产生冲突

![](resources/2022-12-04-20-39-40.png)

修改冲突的文件
![](resources/2022-12-04-20-40-08.png)

提交合并
![](resources/2022-12-04-20-43-31.png)

删除不要的分支
![](resources/2022-12-04-20-45-34.png)

总结：
![](resources/2022-12-07-14-55-00.png)

![](resources/2022-12-07-15-02-11.png)