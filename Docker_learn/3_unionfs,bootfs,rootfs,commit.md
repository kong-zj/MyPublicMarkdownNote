# 镜像原理

## 镜像是什么

![](2022-12-18-21-59-07.png)

## UnionFS 联合文件系统（花卷）

![](2022-12-18-22-01-04.png)

## Docker镜像加载原理

![](2022-12-18-22-02-53.png)
![](2022-12-18-22-06-50.png)

## 分层的镜像

![](2022-12-18-22-11-26.png)

举例：Tomcat镜像
![](2022-12-18-22-13-03.png)

## 为什么Docker镜像采用这样的分层结构

共享资源
![](2022-12-18-22-16-58.png)
公用组件，解耦合

## 特点

![](2022-12-18-22-20-01.png)

# 提交容器命令

镜像是只读的，我们修改的是容器

![](2022-12-18-22-21-41.png)
类似Git中的```commit```命令

## commit

通过下面的例子学习commit的使用

### 成功运行tomcat镜像

命令```docker run -it -p 8888:8080 tomcat```中的```-p 8888:8080```表示把容器内部的8080端口映射到外部的8888端口
![](2022-12-18-22-33-05.png)
如果把```-p 8888:8080```改成```-P```就是随机分配端口

新版的tomcat访问网页得到404是正常的，因为webapps文件夹下没有东西

### 修改tomcat容器

进入容器
![](2022-12-18-22-43-21.png)

在webapps文件夹下新建ROOT文件夹，在其中新建index.html文件并写入
![](2022-12-18-22-54-03.png)
这时，已经能在浏览器中访问

### 以当前的容器为模板commit一个新镜像

命令```docker commit -a "作者名" -m "提交日志" [容器ID] [起的镜像名]:[版本号]```
![](2022-12-18-23-00-04.png)

### 关掉所有正在运行的容器

命令```docker rm -f $(docker ps -q)```
![](2022-12-18-23-02-54.png)

### 启动自己的镜像

![](2022-12-18-23-10-06.png)


